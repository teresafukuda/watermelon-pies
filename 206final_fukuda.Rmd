---
title: "ESM206 Final"
author: "Teresa Fukuda"
date: "12/7/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages and data}

# load packages

library(tidyverse) # wrangle and look at data 
library(janitor) # clean up names to snakecase yay
library(car) # vif
library(effsize) # compute effect sizes
library(corrplot) # For correlation matrices
library(kableExtra) # making tables with kable()

# load data

ca_county_pesticides <- read_csv("ca_county_pesticides.csv")
climate_opinion <- read_csv("climate_opinion.csv")
pesticide_residues<- read_csv("PesticideResidues.csv")
tmas_df <- read_csv("tmas_df.csv")
ucsb_climate <- read_csv("ucsb_climate.csv")


```


### Task 1. Climate Change Opinions
a. A brief statement (1-sentence) explaining the type of analysis you chose to perform, and why it is appropriate.

b. An exploratory correlation matrix for all continuous variables (make it readable, but it does not need to be finalized and you do not need to add a figure caption).
```{r Task 1b}

# For Task 1: Explore relationships between climate change perspectives, information exposure, education attainment, poverty levels and coastline on the proportion of people who believe that global warming is happening (i.e., ‘happening’ should be your dependent variable).

# Exploratory data visualization

climate_opinion_vis <- ggplot (climate_opinion)+
  geom_point(aes(y=happening, x=poverty_rate)) +
  geom_point(aes(y=happening, x=bachelors), color="red") +
  geom_point(aes(y=happening, x=mediaweekly), color="blue") +
  geom_point(aes(y=happening, x=discuss), color="orange") +
  geom_point(aes(y=happening, x=consensus), color="green")
  
climate_opinion_vis

# create a df with only the numeric data
pair_df <- climate_opinion[2:7]

# look at the pairwise graphs of the data from pairs_df
pairs(pair_df)
# could be linear relationship for most; the poverty_rate plots look more blob than linear

# create a correlation matrix df to use in the corrplot
cor_df <- cor(pair_df)

# visually look at this using corrplot function to make correlation matrix
corrplot(cor_df, #input matrix of correlation data, not original data
         type= "upper",# only shows upper half of matrix (so as not to repeat data)
         method= "ellipse",
         tl.col="black", # change label text color and size
         tl.cex=0.5) 

```

c. A finalized table of results for your analyses (you may present more than one model), with a figure caption.

```{r linear}

# Create a multiple linear regression for climate opinions (happening is output, which is a continuous measurable variable)

# Want the reference level to be California

climate_opinion$GeoName <- factor(climate_opinion$GeoName)
climate_opinion$GeoName <- fct_relevel(climate_opinion$GeoName, "California")

# Saturated model-- all variables
climate_opinion_lm1 <- lm (happening ~ GeoName+consensus+discuss+mediaweekly+bachelors+poverty_rate+coastline, data=climate_opinion)
# error: singularities
summary(climate_opinion_lm1)


# trying another model without consensus or geoname (geoname might not be important relative to coastline), because of a very strong correlation with happening
climate_opinion_lm2 <- lm (happening ~ discuss+mediaweekly+bachelors+poverty_rate+coastline, data=climate_opinion)

summary(climate_opinion_lm2)

plot(climate_opinion_lm2)
# nothing too alarming here

AIC(climate_opinion_lm2)
vif(climate_opinion_lm2)
    
    
#but what if I keep geoname and remove coastline?
climate_opinion_lm3 <- lm (happening ~ discuss+mediaweekly+bachelors+poverty_rate+GeoName, data=climate_opinion)

# GeoName coefficients don't really make sense... living in Nevada all else the same shouldn't make someone believe in climate change that much more. Nope. I don't think this model is very good... 

summary(climate_opinion_lm3)

# Ok, one more: what if I consider the states by region-- instead of 




```

d. Choose two coefficients in the model that you find interesting (either because they are expected or unexpected). For each, write a single sentence explaining what that coefficient means in terms of an expected change in the dependent variable.

e. Based on diagnostic plots, describe (1 - 2 sentences) if you have concerns about heteroscedasticity or normality of residuals for your model(s). You do not need to include the diagnostic plots in your final document.

### Task 2. UCSB Campus Climate Survey-- Respectfulness by Respondent Race/Ethnicity

a. In 1 - 2 sentences: What type of analysis will you perform? In the context of this task, what research question will your analysis answer?

b. A one sentence finalized statement of the statistical results for the analysis you decided on in (a). You are not expected to do post-hoc testing, but you can if you want to.

```{r}

# Looking at all continuous data, with more than two variables; going to use chi squared. This will answer the question: Is there a significant association between perceived respect on campus between racial groups? 

# H0: No association; proportions of answers are similar across racial groups
# H1: There is an association between race and perceived respect

ucsb_climate_x2 <- chisq.test(ucsb_climate_a)
ucsb_climate_x2
# x-squared = 1489.6, df = 18, p-value <2.2e-16
# p value < 0.001, significant association between race/ehtnicity and perception of respect on campus

# make names in df snakecase
ucsb_climate_a <- ucsb_climate %>%
  clean_names() %>% 
  select(-"x1") %>% 
  as.matrix(.)

rownames(ucsb_climate_a)<- c("African/African American" ,"American Indian/Native Alaskan","Asian/Asian American" ,"Hispanic/Latino","Middle Eastern/Southeast Asian/Southern African","Pacific Islander","White")

campusclimate_prop <- prop.table(ucsb_climate_a,1)
campusclimate_prop

# c. A finalized figure or table that clearly shows counts and/or proportions of respondents’ perceptions of campus respect for each race/ethnicity reporting. Include a caption.

campusclimate_table <- kable(round(campusclimate_prop,3)) %>% 
   kable_styling(bootstrap_option = c("striped", "hover"), full_width = FALSE

campusclimate_table

# d. A concise 2 - 3 sentence discussion of interesting differences and/or similarities across groups, and notable big picture trends.



```

